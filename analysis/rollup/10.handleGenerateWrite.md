# handleGenerateWrite

执行完 "build" 之后就是 "generate" 阶段了。

先看下 handleGenerateWrite 的方法定义：

src/rollup/rollup.ts

```ts
async function handleGenerateWrite(
  isWrite: boolean,
  inputOptions: NormalizedInputOptions,
  unsetInputOptions: ReadonlySet<string>,
  rawOutputOptions: OutputOptions,
  graph: Graph
): Promise<RollupOutput> {
  const {
    options: outputOptions,
    outputPluginDriver,
    unsetOptions
  } = await getOutputOptionsAndPluginDriver(
    rawOutputOptions,
    graph.pluginDriver,
    inputOptions,
    unsetInputOptions
  );
  return catchUnfinishedHookActions(outputPluginDriver, async () => {
    const bundle = new Bundle(outputOptions, unsetOptions, inputOptions, outputPluginDriver, graph);
    const generated = await bundle.generate(isWrite);
    if (isWrite) {
      timeStart('WRITE', 1);
      if (!outputOptions.dir && !outputOptions.file) {
        return error(errorMissingFileOrDirOption());
      }
      await Promise.all(
        Object.values(generated).map(chunk =>
          graph.fileOperationQueue.run(() => writeOutputFile(chunk, outputOptions))
        )
      );
      await outputPluginDriver.hookParallel('writeBundle', [outputOptions, generated]);
      timeEnd('WRITE', 1);
    }
    return createOutput(generated);
  });
}
```

handleGenerateWrite 接收的参数：

- isWrite 表示是否需要将打包后的代码写入文件
- inputOptions 是 rollup 的 inputOptions 配置
- unsetInputOptions 是一个空的 Set
- rawOutputOptions 是我们传入的打包输出配置
- graph 就是 rollup 的模块图，它保存了所有的源码信息和模块相关的信息

handleGenerateWrite 方法内部首先通过 const { options: outputOptions, outputPluginDriver, unsetOptions } = getOutputOptionsAndPluginDriver(rawOutputOptions, graph.pluginDriver, inputOptions, unsetInputOptions) 得到经过 merge 后的 outputOptions，outputPluginDriver, unsetOption。然后执行了 return catchUnfinishedHookActions() 操作。
